<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" th:fragment="layout(content)">

<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>Farmer Zone - GreenAgriTrade</title>
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
		name='viewport' />
	<link rel="stylesheet" href="../assets/css/bootstrap.min.css">

	<!--Data Table CSS  -->
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
	<link rel="stylesheet" type="text/css"
		href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/2.1.3/css/dataTables.bootstrap5.css" />

	<link rel="stylesheet" href="../assets/css/ready.css">
	<link rel="stylesheet" href="../assets/css/demo.css">
	<link rel="stylesheet" href="../css/table.css">
	<style>
		body {
			font-size: larger;
			font-family: Georgia, 'Times New Roman', Times, serif;
		}
	</style>

	<style type="text/css">
		td,
		th {
			white-space: nowrap !important;
		}
	</style>
</head>

<body>
	<div class="wrapper">
		<div class="main-header">
			<div class="logo-header text-center">
				<a href="dashboard" class="logo">GreenAgriTrade</a>
				<button class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse"
					data-target="collapse" aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<button class="topbar-toggler more">
					<i class="la la-ellipsis-v"></i>
				</button>
			</div>
			<nav class="navbar navbar-header navbar-expand-lg">
				<div class="container-fluid">

					<ul class="navbar-nav topbar-nav ml-md-auto align-items-center">

						<li class="nav-item dropdown">
							<a class="dropdown-toggle profile-pic" data-toggle="dropdown" href="#"
								aria-expanded="false">
								<img th:if="${session.loggedInFarmer != null and session.loggedInFarmer.profilePic != null}"
									th:src="@{'/Farmer/profilePic/' + ${session.loggedInFarmer.id}}" alt="user-img"
									class="img-circle" style="width: 50px; height: 50px;">

								<img id="profilePic"
									th:if="${session.loggedInFarmer == null or session.loggedInFarmer.profilePic == null}"
									th:src="@{/assets/img/profile.jpg}" alt="user-img" width="36" class="img-circle">

							</a>

							<span th:text="${session.loggedInFarmer.name}"></span>
							</a>
							<ul class="dropdown-menu dropdown-user">
								<li>
									<div class="user-box">
										<div class="u-img">
											<img th:if="${session.loggedInFarmer.profilePic !=null}"
												th:src="@{'/Farmer/profilePic/' + ${session.loggedInFarmer.id}}"
												alt="user">
											<img th:if="${session.loggedInFarmer == null or session.loggedInFarmer.profilePic == null}"
												th:src="@{/assets/img/profile.jpg}" alt="user-img" width="36"
												class="img-circle">
										</div>
										<div class="u-text">
											<h4 th:text="${session.loggedInFarmer.name}"></h4>
											<p th:text="${session.loggedInFarmer.email}" class="text-muted">
												business@Agritrade.in</p>
											<!-- Trigger Button -->
											<button type="button" class="btn btn-danger fw-bold shadow"
												data-bs-toggle="modal" data-bs-target="#viewProfileModal">
												View Profile
											</button>
										</div>
									</div>
								</li>
								<div class="dropdown-divider"></div>
								<!-- Modal for update profile-->

								<!-- Trigger Button -->
								<button type="button" class="btn" data-bs-toggle="modal"
									data-bs-target="#updateProfileModal">
									Update Profile Pic
								</button>

								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="ChangePassword">
									<i class="ti-settings"></i>
									Change Password</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="logout">
									<i class="fa fa-power-off"></i> Logout</a>
							</ul> <!-- /.dropdown-user -->
						</li>
					</ul>
				</div>
			</nav>
		</div>
		<div class="sidebar">
			<div class="scrollbar-inner sidebar-wrapper">
				<div class="user">
					<div class="photo">
						<img id="profileImage" th:if="${session.loggedInFarmer.profilePic !=null}"
							th:src="@{'/Farmer/profilePic/' + ${session.loggedInFarmer.id}}" alt="user-img">
						<img id="profilePic"
							th:if="${session.loggedInFarmer == null or session.loggedInFarmer.profilePic == null}"
							th:src="@{/assets/img/profile.jpg}" alt="user-img" width="36" class="img-circle">

					</div>
					<div class="info">
						<a data-toggle="collapse" href="#collapseExample" aria-expanded="true">
							<span>
								<span class="text-primary" th:text="${session.loggedInFarmer.name}"></span>
								<span class="user-level">Farmer</span>
							</span>
						</a>
					</div>
				</div>
				<ul class="nav">
					<li class="nav-item" th:classappend="${active1}">
						<a href="FarmerDashboard">
							<i class="la la-dashboard text-primary"></i>
							<p class="text-dark">Dashboard</p>
							<span class="badge badge-count"></span>
						</a>
					</li>
					<li class="nav-item dropdown hidden-care" th:classappend="${active2}">
						<a class="nav-link" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
							aria-haspopup="true" aria-expanded="false">
							<i class="la la-user-plus"></i>
							<p class="text-dark">Manage Merchants</p>
							<span class="badge" style="font-size: 18px;"><span class="caret"
									style="margin-left: -10px;"></span></span>
						</a>
						<div class="dropdown-menu w-75" aria-labelledby="navbarDropdown">
							<a class="dropdown-item text-dark" href="newmerchant">New Merchants</a>
							<a class="dropdown-item text-dark" href="verifiedmerchant">Verified Merchants</a>
							<a class="dropdown-item text-dark" href="disablemerchant">Disabled Merchants</a>
						</div>
					</li>

					<li class="nav-item dropdown hidden-caret" th:classappend="${active3}">
						<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
							data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="la la-user-plus"></i>
							<p class="text-dark">Manage Farmers</p>
							<span class="badge" style="font-size: 18px;"><span class="caret"
									style="margin-left: -15px;"></span></span>
						</a>
						<div class="dropdown-menu w-75" aria-labelledby="navbarDropdown">
							<a class="dropdown-item text-dark" href="newformer">New Farmers</a>
							<a class="dropdown-item text-dark" href="verifiedformer">Verified Farmers</a>
							<a class="dropdown-item text-dark" href="disableformer">Disabled Farmers</a>
						</div>
					</li>

					<li class="nav-item text-dark" th:classappend="${active4}">
						<a href="ViewOrder">
							<i class="la la-fonticons"></i>
							<p class="text-dark">View Orders</p>
						</a>
					</li>

					<li class="nav-item text-dark" th:classappend="${active5}">
						<a href="AddCategory">
							<i class="la la-bell"></i>
							<p class="text-dark">Add Category</p>
						</a>
					</li>

					<li class="nav-item text-dark" th:classappend="${active6}">
						<a href="enquiry">
							<i class="la la-bullhorn"></i>
							<p class="text-dark">Enquiries</p>
						</a>
					</li>

					<li class="nav-item py-4">&nbsp;</li>
				</ul>
			</div>
		</div>

		<div class="main-panel">
			<div class="content">
				<div th:replace="${content}"></div>
			</div>
			<footer class="footer">
				<div class="container-fluid">
					<nav class="pull-left">
						<ul class="nav">
							<li class="nav-item"><a class="nav-link" href="dashboard"> Dashboard </a></li>
							<li class="nav-item"><a class="nav-link" href="#"> Help </a></li>
							<li class="nav-item"><a class="nav-link" href=""> Licenses </a></li>
						</ul>
					</nav>
					<div class="copyright ml-auto">
						2025, made with <i class="la la-heart heart text-danger"></i> by <a
							href="https://www.instagram.com/lucky_agency_4149" target="_blank">Divakar Maurya</a>
					</div>
				</div>
			</footer>
		</div>
	</div>
	
	
	<!-- Modal for profile pic -->
			<div class="modal fade" id="updateProfileModal" tabindex="-1" aria-labelledby="updateProfileModalLabel"
				aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content border-primary shadow-lg">
						<div class="modal-header bg-primary text-white">
							<h5 class="modal-title fw-bold text-center" id="updateProfileModalLabel">Update Profile</h5>
							<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>

						<div class="modal-body">
							<div class="text-center">
								<img id="profilePic" th:if="${session.loggedInFarmer.profilePic !=null}"
									th:src="@{'/Farmer/profilePic/' + ${session.loggedInFarmer.id}}"
									th:attr="data-farmer-id=${session.loggedInFarmer.id}"
									class="rounded-circle border border-3 border-primary shadow"
									style="width:120px; height:120px; object-fit:cover;" />

								<img id="profilePic"
									th:if="${session.loggedInFarmer == null or session.loggedInFarmer.profilePic == null}"
									th:src="@{/assets/img/profile.jpg}" th:attr="data-farmer-id=${session.loggedInFarmer.id}"
									class="rounded-circle border border-3 border-primary shadow"
									style="width:120px; height:120px; object-fit:cover;" />

							</div>

							<div class="mt-4 text-center p-3 bg-light rounded shadow-sm">
								<!-- File Upload -->
								<div class="mb-3">
									<input type="file" id="profileFile"
										class="form-control w-75 mx-auto border-primary shadow-sm" />
								</div>

								<!-- Change Profile Button -->
								<div class="mb-3">
									<button id="uploadBtn" class="btn btn-success px-4 fw-bold shadow-lg rounded-pill">
										Change Profile
									</button>
								</div>

								<!-- Remove Profile Picture Button -->
								<form th:action="@{removeProfilePic}" method="post" class="d-inline-block">
									<button type="submit" class="btn btn-outline-danger px-4 fw-bold shadow-sm rounded-pill">
										<i class="bi bi-trash"></i> Remove Profile
									</button>
								</form>
							</div>

						</div>

						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

						</div>
					</div>
				</div>
			</div>
	<!--Modal Update Profile end-->

	<!-- View Profile Modal -->
		<!-- View Profile Modal -->
		<div class="modal fade" id="viewProfileModal" tabindex="-1" aria-labelledby="viewProfileModalLabel"
			aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-lg">
				<div class="modal-content border-primary shadow-lg overflow-visible">

					<!-- Header with Profile Picture -->
					<div class="modal-header bg-primary text-white justify-content-center position-relative">
						<h5 class="modal-title fw-bold" id="viewProfileModalLabel">P</h5>
						<button type="button" class="btn-close btn-close-white position-absolute end-0 me-3"
							data-bs-dismiss="modal" aria-label="Close"></button>

						<!-- Profile Pic Overlapping -->
						<div class="position-absolute top-100 start-50 translate-middle" style="margin-top: -40px;">
							<img id="profileImage" th:if="${session.loggedInFarmer.profilePic !=null}"
								th:src="@{'/Farmer/profilePic/' + ${session.loggedInFarmer.id}}" alt="Profile Picture"
								class="rounded-circle border border-3 border-white shadow"
								style="width:130px; height:130px; object-fit:cover;" />

							<img id="profilePic"
								th:if="${session.loggedInFarmer == null or session.loggedInFarmer.profilePic == null}"
								th:src="@{/assets/img/profile.jpg}" alt="Profile Picture"
								class="rounded-circle border border-3 border-white shadow"
								style="width:130px; height:130px; object-fit:cover;" />

						</div>
					</div>

					<!-- Body -->
					<div class="modal-body mt-5" style="background-color: #f8f9fa;">
						<div class="text-center mb-4">
							<h4 th:text="${session.loggedInFarmer.role}" class="fw-bold"></h4>
							<h4 th:text="${session.loggedInFarmer.name}" class="fw-bold text-primary"></h4>
							<p class="text-muted fs-5" th:text="${session.loggedInFarmer.email}"></p>
						</div>

						<div class="table-responsive">
							<table class="table table-bordered table-hover align-middle"
								style="font-size: 1.05rem; background-color: #ffffff;">
								<tbody>
									<tr>
										<th class="bg-light text-primary" style="width: 40%;">Contact Number</th>
										<td th:text="${session.loggedInFarmer.contactNumber}" class="fw-semibold"></td>
									</tr>
									<tr>
										<th class="bg-light text-primary">Aadhaar Number</th>
										<td th:text="${session.loggedInFarmer.aadharNumber}" class="fw-semibold"></td>
									</tr>
									<tr>
										<th class="bg-light text-primary">PAN Number</th>
										<td th:text="${session.loggedInFarmer.panCard}" class="fw-semibold"></td>
									</tr>
									<tr>
										<th class="bg-light text-primary">Address</th>
										<td th:text="${session.loggedInFarmer.address}" class="fw-semibold"></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>

					<!-- Footer -->
					<div class="modal-footer justify-content-between" style="background-color: #f1f3f5;">
						<button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Close</button>
						<a th:href="@{'/Farmer/editProfile/' + ${session.loggedInFarmer.id}}"
							class="btn btn-primary fw-bold px-4">Edit Profile</a>
					</div>

				</div>
			</div>
		</div>
		<!-- View Profile Modal end -->
		
		
	
	
		
		<input type="text" id="msg" th:if="${msg}" th:value="${msg}">
			
			<script type="text/javascript">
				
				var msg = document.getElementById("msg");
				if(msg.value!="")
				{
					alert(msg.value);
				}
			</script>
			
			<!-- Bootstrap JS Bundle (includes Popper) -->
							<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

							<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
							<script th:inline="javascript">
								/*<![CDATA[*/
								let farmerId = /*[[${session.loggedInFarmer.id}]]*/ 0;

								$("#uploadBtn").on("click", function () {
									const file = $("#profileFile")[0].files[0];
									if (!file) {alert("Please select a file."); return;}

									const formData = new FormData();
									formData.append("file", file);

									$.ajax({
										url: "/Farmer/uploadProfilePic",
										type: "POST",
										data: formData,
										processData: false,
										contentType: false,
										success: function (response) {
											const txt = (response || "").toString().trim().toLowerCase();
											if (txt === "success") {                    // works for "Success"/"SUCCESS"/"success"
												alert("Profile Updated!");
												if (!farmerId) farmerId = $("#profilePic").attr("data-farmer-id");
												$("#profilePic").attr("src", "/Farmer/profilePic/" + FarmerId + "?t=" + new Date().getTime());
											} else {
												alert("Error uploading! Server said: " + response);
											}
										},
										error: function (xhr) {
											alert("Error uploading! " + (xhr.responseText || xhr.status));
										}
									});
								});
								/*]]>*/
							</script>

						


			


		
		<script src="../assets/js/core/jquery.3.2.1.min.js"></script>
		<script src="../assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
		<script src="../assets/js/core/popper.min.js"></script>
		<script src="../assets/js/core/bootstrap.min.js"></script>
		<script src="../assets/js/plugin/chartist/chartist.min.js"></script>
		<script src="../assets/js/plugin/chartist/plugin/chartist-plugin-tooltip.min.js"></script>

		<!-- <script src="../assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>
	 -->
		<script src="../assets/js/plugin/bootstrap-toggle/bootstrap-toggle.min.js"></script>
		<script src="../assets/js/plugin/jquery-mapael/jquery.mapael.min.js"></script>
		<script src="../assets/js/plugin/jquery-mapael/maps/world_countries.min.js"></script>
		<script src="../assets/js/plugin/chart-circle/circles.min.js"></script>
		<script src="../assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
		<script src="../assets/js/ready.min.js"></script>
		<script src="../assets/js/demo.js"></script>


		<!-- Data table js -->
		<script type="text/javascript" language="javascript"
			src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
		<script type="text/javascript" language="javascript"
			src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
		<script type="text/javascript" language="javascript"
			src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
		<script type="text/javascript" language="javascript"
			src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
		<script type="text/javascript" language="javascript"
			src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
		<script type="text/javascript" language="javascript"
			src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
		<script type="text/javascript" language="javascript"
			src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
		<script type="text/javascript" language="javascript"
			src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.print.min.js"></script>

		<script type="text/javascript">
			$(document).ready(function () {
				$('#example').DataTable({
					dom: 'Bfrtip',
					buttons: [
						'copy', 'csv', 'excel', 'pageLength'			//, 'pdf', 'print'
					],
					lengthMenu: [
						[10, 25, 50, 100, -1],
						['10', '25', '50', '100', 'all']
					]
				});
			});
		</script>


		<!-- Modal for displaying the current image from table-->
		<div class="modal fade" style="left: 50; top: 40;" id="imageModal" tabindex="-1" role="dialog"
			aria-labelledby="imageModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content" style="width: 80%;">
					<div class="modal-header">
						<h5 class="modal-title" id="imageModalLabel">Profile Picture</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<img id="modalImage" src="" class="img-fluid" alt="Profile Image">
					</div>
				</div>
			</div>
		</div>


		<!-- JavaScript to open the modal and set the image -->
		<script>
			// Select all profile images with the class 'profile-img'
			var profileImages = document.querySelectorAll('.profile-img');

			// Modal elements
			var modalImage = document.getElementById('modalImage');
			var imageModal = new bootstrap.Modal(document.getElementById('imageModal'));

			// Ensure that profileImages is not empty
			if (profileImages.length > 0) {
				profileImages.forEach(function (profileImage) {
					// Add click event to each profile image
					profileImage.addEventListener('click', function () {
						var imgSrc = profileImage.getAttribute('src'); // Get the source of the clicked image
						modalImage.setAttribute('src', imgSrc); // Set the source of the image in the modal
						imageModal.show(); // Show the modal manually
					});
				});
			} else {
				console.error('No profile images found.');
			}

		</script>
	</body>

	</html>
